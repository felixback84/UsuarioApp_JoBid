"use strict";!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e("undefined"==typeof global?n:global):"function"==typeof define&&define.amd?define([],function(){return e(n)}):n.framebus=e(n)}(this,function(n){function e(n){return null==n?!1:null==n.Window?!1:n.constructor!==n.Window?!1:(w.push(n),!0)}function r(n){var e,r={};for(e in m)m.hasOwnProperty(e)&&(r[e]=m[e]);return r._origin=n||"*",r}function t(n){var e,r,t=i(this);return s(n)?!1:s(t)?!1:(r=Array.prototype.slice.call(arguments,1),e=a(n,r,t),e===!1?!1:(d(b.top||b.self,e,t),!0))}function o(n,e){var r=i(this);return y(n,e,r)?!1:(E[r]=E[r]||{},E[r][n]=E[r][n]||[],E[r][n].push(e),!0)}function u(n,e){var r,t,o=i(this);if(y(n,e,o))return!1;if(t=E[o]&&E[o][n],!t)return!1;for(r=0;r<t.length;r++)if(t[r]===e)return t.splice(r,1),!0;return!1}function i(n){return n&&n._origin||"*"}function s(n){return"string"!=typeof n}function a(n,e,r){var t=!1,o={event:n,origin:r},u=e[e.length-1];"function"==typeof u&&(o.reply=v(u,r),e=e.slice(0,-1)),o.args=e;try{t=M+JSON.stringify(o)}catch(i){throw new Error("Could not stringify event: "+i.message)}return t}function f(n){var e,r,t,o;if(n.data.slice(0,M.length)!==M)return!1;try{e=JSON.parse(n.data.slice(M.length))}catch(u){return!1}return null!=e.reply&&(r=n.origin,t=n.source,o=e.reply,e.reply=function(n){var e=a(o,[n],r);return e===!1?!1:(t.postMessage(e,r),void 0)},e.args.push(e.reply)),e}function c(e){b||(b=e||n,b.addEventListener?b.addEventListener("message",g,!1):b.attachEvent?b.attachEvent("onmessage",g):null===b.onmessage?b.onmessage=g:b=null)}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=16*Math.random()|0,r="x"===n?e:3&e|8;return r.toString(16)})}function g(n){var e;s(n.data)||(e=f(n),e&&(p("*",e.event,e.args,n),p(n.origin,e.event,e.args,n),h(n.data,e.origin,n.source)))}function p(n,e,r,t){var o;if(E[n]&&E[n][e])for(o=0;o<E[n][e].length;o++)E[n][e][o].apply(t,r)}function x(n){return n.top!==n?!1:null==n.opener?!1:n.opener===n?!1:n.opener.closed===!0?!1:!0}function d(n,e,r){var t;try{for(n.postMessage(e,r),x(n)&&d(n.opener.top,e,r),t=0;t<n.frames.length;t++)d(n.frames[t],e,r)}catch(o){}}function h(n,e,r){var t,o;for(t=w.length-1;t>=0;t--)o=w[t],o.closed===!0?w=w.slice(t,1):r!==o&&d(o.top,n,e)}function v(n,e){function r(o,u){n(o,u),m.target(e).unsubscribe(t,r)}var t=l();return m.target(e).subscribe(t,r),t}function y(n,e,r){return s(n)?!0:"function"!=typeof e?!0:s(r)?!0:!1}var b,m,w=[],E={},M="/*framebus*/";return c(),m={target:r,include:e,publish:t,pub:t,trigger:t,emit:t,subscribe:o,sub:o,on:o,unsubscribe:u,unsub:u,off:u}});